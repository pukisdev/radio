var app = angular
          .module('appRoot', ['ngMessages','angularUtils.directives.dirPagination','ngRoute', 'currencyMask', 'ui.bootstrap'])
          .config(function($interpolateProvider){
              $interpolateProvider.startSymbol('[[');
              $interpolateProvider.endSymbol(']]');
          })
        .directive('loading', ['$http',function($http){
          return {
            restrict: 'A',
            link : function(scope, element, attrs){
              scope.isLoading = function(){
                return $http.pendingRequests.length > 0;
              };

              scope.$watch(scope.isLoading, function(value){
                if(value){
                  element.show(); 
                } else{
                  element.hide();
                }
              })
            }
          }
        }]);


app.controller('dataFormController', function($scope, $http, $uibModal, $log) {
  $scope.modalstate = {};
  $scope.parseInt = parseInt;
  $scope.libraryTemp = {};
  $scope.dataForm = {};
  $scope.totalItemsTemp = {};
  $scope.totalItems = 0;
  $scope.subUrl = '/keu/faSetoranBank';
  $modalName ='idModalMst';
  $scope._token = {};
  $scope._pageNumber = 1;
  $scope.checked = false;

    $http({
      'method'  : 'GET',
      'url'   : '/token' 
    }).success(function(response){
      //console.log(response);
      $scope._token     = response;
    }).error(function(response){
        //console.log(response);
    });

    $scope.lovSetoranBank = function (val){
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
      $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
      var modalInstance = $uibModal.open({
        animation: true,
        templateUrl:  '/assets/ng/views/keu/lov/lovSetoranBank.html', 
        controller:   'lovSetoranBankController',
        size: 'lg',
        resolve: {
          parameter : function(){
            return $scope.params;
          }, 
        }
      });
      modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
        if(val == 0){
          $scope.dataForm['bukti_awal'] = _element.no_bukti;
        } 
        else{
          $scope.dataForm.bukti_akhir = _element.no_bukti;
        }      
      }, function () {
        $log.info('Modal dismissed at: ' + new Date());
      });
    }


    $scope.cekFilter = function (value) {
      //$scope.dataForm = {};
    }

    $scope.cetak = function () {
      //$scope.dataForm = {};
      var tipe = $scope.checked;
      //console.log($scope.tgl_awal);
      if(tipe == false){
        var jenis = 'tgl';
        var awal  =$scope.dataForm['tgl_awal'];
        var akhir = $scope.dataForm['tgl_akhir'];
        //alert($scope.dataForm['tgl_awal']);

      }
      else{
        var jenis  = 'no';
        var awal  = $scope.dataForm['bukti_awal'];
        var akhir = $scope.dataForm.bukti_akhir;
        //alert($scope.bukti_awal);
      }

      //alert($filter('date')(awal, 'dd/MM/yyyy'));
      //$('#frmMst').attr('action', '/rpt/pdf/keu/notaPenerimaan/'+jenis+'/'+awal+'/'+akhir);
      //$('#frmMst').attr('method', 'GET');
      //$('#frmMst').submit();
      
      //window.open('/rpt/pdf/keu/notaPenerimaan/'+jenis+'/'+awal+'/'+akhir);

      //alert($scope.checked);
      //alert('oke');
      /*$http.get('/rpt/pdf/pms/order')
          .success(function(response){
            $scope.dataKetNama = response;
      });*/
      //window.open('/rpt/pdf/pms/order');

      //document.frmMst.target = "/rpt/pdf/pms/order";
     
      $('#frmMst').attr('action', '/rpt/pdf/keu/setoranBank');
      $('#frmMst').attr('method', 'POST');
      $('#frmMst').submit();
    }

});


function apiModifyTable(originalData,id,response){
    angular.forEach(originalData, function (item,key) {
      // console.log(item.id_customer +' \\ '+key+' / '+id);
        if(item.no == id){
            originalData[key] = response;
        }
    });
    return originalData;
}