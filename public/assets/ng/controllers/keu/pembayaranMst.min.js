var app = angular
          .module('appRoot', ['ngMessages','ngSanitize', 'angularUtils.directives.dirPagination','ngRoute', 'currencyMask', 'ui.bootstrap', 'rte-angular'])
          .config(function($interpolateProvider){
              $interpolateProvider.startSymbol('[[');
              $interpolateProvider.endSymbol(']]');
          })
        .directive('loading', ['$http',function($http){
          return {
            restrict: 'A',
            link : function(scope, element, attrs){
              scope.isLoading = function(){
                return $http.pendingRequests.length > 0;
              };

              scope.$watch(scope.isLoading, function(value){
                if(value){
                  element.show(); 
                } else{
                  element.hide();
                }
              })
            }
          }
        }]);


app.controller('dataFormController', function($scope, $http, $sce, $uibModal, $log) {
  $scope.modalstate = {};
  $scope.parseInt = parseInt;
  $scope.libraryTemp = {};
  $scope.dataForm = {};
  $scope.totalItemsTemp = {};
  $scope.totalItems = 0;
  $scope.subUrl = '/keu/pembayaran';
  $modalName ='idModalMst';
  $scope._token = {};
  $scope._pageNumber = 1;

    $http({
      'method'  : 'GET',
      'url'   : '/token' 
    }).success(function(response){
      //console.log(response);
      $scope._token     = response;
      
      //retrieve employees listing from API
      getResultsPage($scope._pageNumber);

    }).error(function(response){
        //console.log(response);
    });

    $scope.setJenisBukti = function () {
      var jenis  = event.target.value;
      //totalMst();
      if(jenis == 'K'){
        $scope.show_kas  = false;
        $scope.show_bank = false;
        $scope.show_giro = false;
      }
      else if(jenis == 'B'){
        $scope.show_kas  = true;
        $scope.show_bank = true;
        $scope.show_giro = false;
      }
      else if(jenis == 'G'){
        $scope.show_kas  = true;
        $scope.show_bank = false;
        $scope.show_giro = true;
      }
    }

    //show modal form
    $scope.toggle = function(modalstate, id){
      var _url = $scope._token['url']+ $scope.subUrl;
      if($.isEmptyObject($scope._token)) return false;

      $scope.modalstate = modalstate; 
      
      switch(modalstate){
        case 'add' :
          $scope.form_title = 'Tambah Data';
          $scope.dataForm = {};
          $scope.dataForm['bpk']    = [];
          $scope.dataForm['bpb']    = [];
          $scope.dataForm['bpb_b']  = [];
          $scope.dataForm['bpb_j']  = [];
          $scope.dataForm['bpc']    = [];
          $scope.dataForm['gl']     = [];
          $scope.dataForm['gl_a']   = [];
          $scope.dataForm['gl_c']   = [];
          $scope.dataForm['ap']     = [];
          $scope.dataForm['cc']     = [];
          $scope.formTampil = true;
        break;
        case 'edit' :
          $scope.form_title = 'Edit Data';
          $scope.idState = id;
          $http.get(_url+"/" +id+'/edit')
            .success(function(response){
              showData(response);
            });
          $scope.formTampil = true;
        break;
        case 'cancel':
          getResultsPage($scope._pageNumber);
        break; 
        default:
        break;
      }
      // $('#'+$modalName).modal('show');
    }

    /*$scope.save = function(modalstate, id){
      alert('oke');
      var _url = $scope._token['url']+ $scope.subUrl;
      if($.isEmptyObject($scope._token)) return false;
      var _method = (modalstate === 'edit') ? 'PUT' : 'POST';
       $http({
        'method'  : _method,
        'url'     : _url + ((modalstate ==='edit') ? '/'+id : ''),
        'data'    : $.param($scope.dataForm),
        'headers' : {'Content-Type': 'application/x-www-form-urlencoded'}
      }).success(function(response){
        if(modalstate === 'edit') {
          new PNotify({
              title : 'Berhasil',
              text  : 'Edit Data Berhasil',
              type  : 'success'
          });
        }
        else {
          //console.log(response);
          new PNotify({
              title : 'Berhasil',
              text  : 'Input Data Berhasil',
              type  : 'success'
          });
          $scope.dataForm   = response;
          $scope.modalstate = 'edit'; 
          $scope.idState    = response.no;
        }
      }).error(function(error){
        new PNotify({
              title : 'Gagal',
              text  : 'Inpu/Edit Data Gagal',
              type  : 'error'
          });
      });
    }*/

  $scope.pageChanged = function(newPage) {
    getResultsPage(newPage);
  };

  $scope.lovSelected = function(idModal, _element){
    
    if($.isEmptyObject($scope.dataForm)){
      $scope.dataForm = {};
    }

    angular.forEach(_element, function (item,key) {
      // console.log(key + '||' +key.indexOf('id'));
      key = (key.indexOf('id') > -1) ? 'f_'+key.substr(3) : key;
      $scope.dataForm[key] = item;
    });
    
    $('#'+idModal).modal('hide');
  }

  $scope.showModal = function (idModal){
    $('#'+idModal).modal('show');
  }

  $scope.selectFile = function(_name){
    // console.log($scope.dataForm[_name].name);
    $scope.dataForm[_name.slice(1)] =  $scope.dataForm[_name].name;
  }

  $scope.getFiles = function(_name){
    var _url = $scope._token['url']+ $scope.subUrl;
    if($.isEmptyObject($scope._token)) return false;
    window.open(_url+'/files/'+_name+'/'+$scope.dataForm[_name], '_blank'); 
  }

  $scope.confirmDelete = function(_data, _index){
      var _url = $scope._token['url']+ $scope.subUrl;
      if($.isEmptyObject($scope._token)) return false;
      
      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        $http({
          'method'  : 'DELETE',
          'url'     : _url+'/'+_data.no 
          // 'url'     : API_URL+$scope.subUrl+'/'+_data.id_customer 
        }).success(function(response){
          $scope._data.splice(_index,1);
          /*$.gritter.add({
                title: 'Application',
                text: 'Data Berhasil Dihapus',
                fade_out_speed: 5000
            });*/
            new PNotify({
              title : 'Berhasil',
              text  : 'Data Berhasil Dihapus',
              type  : 'success'
          });
        }).error(function(response){
          //console.log(response);
          new PNotify({
              title : 'Gagal',
              text  : 'Data Gagal Dihapus',
              type  : 'error'
          });
         /* $.gritter.add({
                title: 'Application',
                text: 'Data Gagal Dihapus',
                fade_out_speed: 5000
            });*/
        });
      }
    }

  $scope.searchDB = function(){
      if($.isEmptyObject($scope._token)) return false;
        if($scope.searchText.length >= 1){
          // console.log($scope.libraryTemp);
          if($.isEmptyObject($scope.libraryTemp)){
                $scope.libraryTemp = $scope._data;
                $scope.totalItemsTemp = $scope.totalItems;
                $scope._data = {};
          }
          getResultsPage(1);
        }else{
          // console.log('masuk');
            if(!$.isEmptyObject($scope.libraryTemp)){
                $scope._data = $scope.libraryTemp ;
                $scope.totalItems = $scope.totalItemsTemp;
                $scope.libraryTemp = {};
            }
        }
    } 

  $scope.setApv = function(_answer, _index){
      var _url = $scope._token['url']+ $scope.subUrl;
      if($.isEmptyObject($scope._token)) return false;

      //console.log(_answer+'/'+_index);
      $http({
        'method'  : 'PUT',
        'url'     : _url+'/'+$scope.dataForm['id_spks']+'/apv', 
        'data'    : { 'jawaban' : _answer, 'komentar' : $scope.dataForm['apv'][_index]['komentar'], 'apv_nip' : $scope.dataForm['apv'][_index]['apv_nip'] },
        // 'headers' : {'Content-Type': 'application/x-www-form-urlencoded'}
      }).success(function(response){
        $scope.dataForm['apv'][_index]['apv_status']=_answer;
        // // console.log(response);
        // $scope._data     = response.data;
        // $scope.totalItems   = response.total;
        // $scope.table = { TotalItems : response.total, CurrentItems : response.to };
      }).error(function(response){
        //console.log(response);
      });

  }  

  $scope.lovNpb = function (_index, _tipe, _value) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovNpb.html', 
      controller:   'lovNpbController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      if(_tipe === 'tambah'){// && $scope.dataForm['det'][0]['no'] !== ''){
        var _data           = new Object();
        _data.no_customer   = _element.no_pp;
        _data.keterangan    = _element.keterangan;
        _data.currency_id   = 'IDR';
        _data.nilai         = _element.total_bayar;
        $scope.dataForm['bpk'].push(_data);
      } else if(_index || _index === 0){
        console.log(_element);
        
        $scope.dataForm['bpk'][_index]= {} ;
        $scope.dataForm['bpk'][_index]['no_customer']     = _element.no_pp;
        $scope.dataForm['bpk'][_index]['keterangan']      = _element.keterangan;
        $scope.dataForm['bpk'][_index]['currency_id']     = _element.currency_id;
        $scope.dataForm['bpk'][_index]['nilai']           = _element.total_bayar;
      } 
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.rmLovNpb = function (_data, _pp, _index) {
      var _url = $scope._token['url'];
      if($.isEmptyObject($scope._token)) return false;

      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        if(_pp){        
          $http({
            'method'  : 'DELETE',
            'url'     : _url+'/keu/pembayaran/det/bukti',
            'params'  : { 'no_pp' : _pp, 'data' : _data } 
          }).success(function(response){

          }).error(function(response){
            console.log(response);
            $.gritter.add({
                  title: 'Application',
                  text: 'Data Gagal Dihapus',
                  fade_out_speed: 5000
              });
          });
        }
        
        $scope.dataForm['bpk'].splice(_index,1);          
      }
  }

  $scope.lovBank = function () {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovBank.html', 
      controller:   'lovBankController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
        if($.isEmptyObject($scope.dataForm['bpb'])) $scope.dataForm['bpb'] = {};
        $scope.dataForm['bpb_b']                  = {} ;
        $scope.dataForm['bpb_b']['no_bank']       = _element.no;
        $scope.dataForm['bpb_b']['nama_bank']     = _element.nama_bank;
        $scope.dataForm['bpb_b']['account_bank']  = _element.no_acc;
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.lovJnsTrans = function () {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovJnsTrans.html', 
      controller:   'lovJnsTransController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
        if($.isEmptyObject($scope.dataForm['bpb'])) $scope.dataForm['bpb'] = {};
        
        $scope.dataForm['bpb_j']                  = {} ;
        $scope.dataForm['bpb_j']['jenis_trans']   = _element.kode_trans;
        $scope.dataForm['bpb_j']['transaksi']     = _element.transaksi;
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.lovBank2 = function (_index, _tipe, _value) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovBank.html', 
      controller:   'lovBankController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      if(_tipe === 'tambah'){// && $scope.dataForm['det'][0]['no'] !== ''){
        var _data               = new Object();
        _data.dari_account      = _element.no_acc;
        _data.keterangan        = ''; 
        _data.coa_id            = ''; 
        $scope.dataForm['bpc'].push(_data);
      } else if(_index || _index === 0){
        //console.log(_element.no_pp+'/'+_index);
        
        $scope.dataForm['bpc'][_index]                  = {} ;
        $scope.dataForm['bpc'][_index]['dari_account']  = _element.no_acc;
      } 
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.rmLovBank2 = function (_data, _pp, _index) {
      var _url = $scope._token['url'];
      if($.isEmptyObject($scope._token)) return false;

      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        if(_pp){        
          $http({
            'method'  : 'DELETE',
            'url'     : _url+'/keu/pembayaran/det/bukti',
            'params'  : { 'no_pp' : _pp, 'data' : _data } 
          }).success(function(response){

          }).error(function(response){
            console.log(response);
            $.gritter.add({
                  title: 'Application',
                  text: 'Data Gagal Dihapus',
                  fade_out_speed: 5000
              });
          });
        }
        
        $scope.dataForm['bpc'].splice(_index,1);          
      }
  }

  $scope.lovAccCoa = function (_index, _tipe, _value) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovAccCoa.html', 
      controller:   'lovAccCoaController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      if(_tipe === 'tambah'){// && $scope.dataForm['det'][0]['no'] !== ''){
        var _data           = new Object();
        //var _data2           = new Object();
        _data.coa_id        = _element.coa_id;
        _data.coa_name      = _element.coa_name;
        //_data2.currency_id   = 'IDR';
        _data.currency_id   = 'IDR';
        $scope.dataForm['gl'].push(_data);
        //$scope.dataForm['gl'].push(_data2);
      } else if(_index || _index === 0){
        //console.log(_element.no_pp+'/'+_index);
        //alert($scope.dataForm['gl'].length);

        //$scope.dataForm['gl'][_index]= {} ;
        $scope.dataForm['gl'][_index]['coa_id']     = _element.coa_id;
        $scope.dataForm['gl'][_index]['coa_name']   = _element.coa_name;
      } 
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.rmLovAccCoa = function (_data, _pp, _index) {
      var _url = $scope._token['url'];
      if($.isEmptyObject($scope._token)) return false;

      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        if(_pp){        
          $http({
            'method'  : 'DELETE',
            'url'     : _url+'/keu/pembayaran/det/bukti',
            'params'  : { 'no_pp' : _pp, 'data' : _data } 
          }).success(function(response){

          }).error(function(response){
            console.log(response);
            $.gritter.add({
                  title: 'Application',
                  text: 'Data Gagal Dihapus',
                  fade_out_speed: 5000
              });
          });
        }
        
        $scope.dataForm['gl'].splice(_index,1);          
        //$scope.dataForm['gl_a'].splice(_index,1);          
      }
  }

  $scope.lovCostCenter = function (_index, _tipe, _value) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovCostCenter.html', 
      controller:   'lovCostCenterController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      if(_tipe === 'tambah'){// && $scope.dataForm['det'][0]['no'] !== ''){
        var _data               = new Object();
        _data.costcenter        = _element.cost_id;
        _data.cost_keterangan   = _element.cost_keterangan;
        $scope.dataForm['gl'].push(_data);
      } else if(_index || _index === 0){
        //console.log(_element.no_pp+'/'+_index);
        
        //$scope.dataForm['gl'][_index]= {} ;
        $scope.dataForm['gl'][_index]['costcenter']       = _element.cost_id;
        $scope.dataForm['gl'][_index]['cost_keterangan']  = _element.cost_keterangan;
      } 
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.lovApCst = function (_index, _tipe, _value) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      // console.log('mane?');
    $scope.params = { };//_f_customer : (_customer) ? _customer : $scope.dataForm['f_customer']  };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl:  '/assets/ng/views/keu/lov/lovApCst.html', 
      controller:   'lovApCstController',
      size: 'lg',
      resolve: {
        parameter : function(){
          //console.log($scope.params);
          return $scope.params;
        }, 
      }
    });
    modalInstance.result.then(function (_element) {
      if($.isEmptyObject($scope.dataForm)){
        $scope.dataForm = {};
      }
      if(_tipe === 'tambah'){// && $scope.dataForm['det'][0]['no'] !== ''){
        var _data           = new Object();
        _data.ap_coa_id     = _element.coa_id;
        _data.ap_coa_name   = _element.coa_name;
        $scope.dataForm['ap'].push(_data);
      } else if(_index || _index === 0){
        //console.log(_element.no_pp+'/'+_index);
        
        $scope.dataForm['ap'][_index]= {} ;
        $scope.dataForm['ap'][_index]['ap_coa_id']       = _element.coa_id;
        $scope.dataForm['ap'][_index]['ap_coa_name']     = _element.coa_name;
      } 
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  }

  $scope.rmLovApCst = function (_data, _pp, _index) {
      var _url = $scope._token['url'];
      if($.isEmptyObject($scope._token)) return false;

      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        if(_pp){        
          $http({
            'method'  : 'DELETE',
            'url'     : _url+'/keu/pembayaran/det/bukti',
            'params'  : { 'no_pp' : _pp, 'data' : _data } 
          }).success(function(response){

          }).error(function(response){
            console.log(response);
            $.gritter.add({
                  title: 'Application',
                  text: 'Data Gagal Dihapus',
                  fade_out_speed: 5000
              });
          });
        }
        
        $scope.dataForm['ap'].splice(_index,1);          
      }
  }

  $scope.save = function(modalstate, id){
    var _url = $scope._token['url']+ $scope.subUrl;
    if($.isEmptyObject($scope._token)) return false;
    $scope.dataForm['keterangan'] = $scope.dataForm['keterangan'].toString();

    $http({
      'method'  : ($scope.dataForm['no_bukti']) ? 'PUT' : 'POST',
      'url'     : _url + (($scope.dataForm['no_bukti']) ? '/'+$scope.dataForm['no_bukti'] : ''),
      'data'    : $.param($scope.dataForm),
      'headers' : {'Content-Type': 'application/x-www-form-urlencoded'}
    }).success(function(response){
      if(modalstate === 'edit') {
          new PNotify({
              title : 'Berhasil',
              text  : 'Edit Data Berhasil',
              type  : 'success'
          });
      }
      else {
          new PNotify({
              title : 'Berhasil',
              text  : 'Input Data Berhasil',
              type  : 'success'
          });
      }
      showData(response);
      $scope.modalstate = 'edit'; 

      $.gritter.add({
            title: 'Application',
            text: 'Data Berhasil Disimpan',
            fade_out_speed: 5000
        });
    }).error(function(error){
      console.log(error);
    });
  }

  $scope.totalMst = function(){
    if($scope.dataForm['jenis_bukti'] == 'K'){
       if($scope.dataForm['bpk']){
        var _total = 0;
        angular.forEach($scope.dataForm['bpk'], function (item,key) {
          _total+=parseInt(item.jumlah);
        });
      }
    }
    else if($scope.dataForm['jenis_bukti'] == 'G'){  
      if($scope.dataForm['bpc']){
        var _total = 0;
        angular.forEach($scope.dataForm['bpc'], function (item,key) {
          _total+=parseInt(item.nilai);
        });
      }
    }  
    else if($scope.dataForm['jenis_bukti'] == 'B'){
      var _total = 0;
      _total+=parseInt($scope.dataForm['bpb']['nilai']);
    }  

    $scope.dataForm['total'] = _total;
  }

  $scope.totalGL = function(){
    var _debet  = 0;
    var _kredit = 0;
      angular.forEach($scope.dataForm['gl'], function (item,key) {
          _debet  += parseInt(item.debet);
          _kredit += parseInt(item.kredit);
      });
      $scope.dataForm['jml_debet']  = _debet;
      $scope.dataForm['jml_kredit'] = _kredit;
  }

  function getResultsPage(pageNumber) {
      $scope.formTampil = false;      
      var _url = $scope._token['url']+ $scope.subUrl;
      if($.isEmptyObject($scope._token)) return false;
      
      $scope._pageNumber = pageNumber;
      
      if(! $.isEmptyObject($scope.libraryTemp)){
        $http({
          'method'  : 'GET',
          'url'   : _url+'?search='+$scope.searchText+'&page='+pageNumber 
        }).success(function(response){
          $scope._data     = response.data;
          $scope.totalItems   = response.total;
          $scope.table = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
          //console.log(response);
        });
      }else{
        $http({
          'method'  : 'GET',
          'url'   : _url+'?page='+pageNumber 
        }).success(function(response){
          //console.log(response);
          $scope._data        = response.data;
          $scope.totalItems   = response.total;
          $scope.table        = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
           //console.log(response);
        });
      }
  }

  /*function showData(_dataBank){
    $scope.dataForm               = [];
    $scope.dataForm               = _dataBank.master;
  }*/
  function showData(_dataTampil){
    var jenis  = _dataTampil.jenis_bukti;
    //totalMst();

    $scope.dataForm           = {};
    $scope.dataForm['bpk']    = [];
    $scope.dataForm['bpb']    = [];
    $scope.dataForm['bpb_b']  = [];
    $scope.dataForm['bpb_j']  = [];
    $scope.dataForm['bpc']    = [];
    $scope.dataForm['gl']     = [];
    $scope.dataForm['gl_a']   = [];
    $scope.dataForm['gl_c']   = [];
    $scope.dataForm['ap']     = [];
    $scope.dataForm['cc']     = [];

    $scope.dataForm               = _dataTampil;
    $scope.dataForm['tgl_cetak']  = new Date(_dataTampil['tgl_cetak']);
    $scope.dataForm['keterangan'] = $sce.trustAsHtml(_dataTampil['keterangan']);
    
    for(gl in _dataTampil.fa_pembayaran_jurnal_det){
      _dataTampil.fa_pembayaran_jurnal_det[gl]['coa_name']        =  (_dataTampil.fa_pembayaran_jurnal_det[gl]['acc_coas_mst']) ? _dataTampil.fa_pembayaran_jurnal_det[gl]['acc_coas_mst']['coa_name'] : null;
      _dataTampil.fa_pembayaran_jurnal_det[gl]['cost_keterangan'] =  (_dataTampil.fa_pembayaran_jurnal_det[gl]['acc_cost_center']) ? _dataTampil.fa_pembayaran_jurnal_det[gl]['acc_cost_center']['cost_keterangan'] : null;
    }
    
    if(jenis == 'K'){
      $scope.show_kas  = false;
      $scope.show_bank = false;
      $scope.show_giro = false;

      $scope.dataForm['bpk']  = _dataTampil.fa_pembayaran_det;
    }
    else if(jenis == 'B'){
      $scope.show_kas  = true;
      $scope.show_bank = true;
      $scope.show_giro = false;

      $scope.dataForm['bpb_b']                  = {};  
      $scope.dataForm['bpb_j']                  = {};  
      $scope.dataForm['bpb_b']['no_bank']       = _dataTampil.fa_pembayaran_bank_det[0]['fa_bank_mst']['no'];
      $scope.dataForm['bpb_b']['nama_bank']     = _dataTampil.fa_pembayaran_bank_det[0]['fa_bank_mst']['nama_bank'];
      $scope.dataForm['bpb_b']['account_bank']  = _dataTampil.fa_pembayaran_bank_det[0]['fa_bank_mst']['no_acc'];
      $scope.dataForm['bpb_j']['jenis_trans']   = _dataTampil.fa_pembayaran_bank_det[0]['fa_jenis_trans_mst']['kode_trans'];
      $scope.dataForm['bpb_j']['transaksi']     = _dataTampil.fa_pembayaran_bank_det[0]['fa_jenis_trans_mst']['transaksi'];
      $scope.dataForm['bpb']                    = _dataTampil.fa_pembayaran_bank_det[0];

      delete $scope.dataForm['bpb']['fa_bank_mst'];
      delete $scope.dataForm['bpb']['fa_jenis_trans_mst'];
    }
    else if(jenis == 'G'){
      $scope.show_kas  = true;
      $scope.show_bank = false;
      $scope.show_giro = true;

      for(bpc in _dataTampil.fa_pembayaran_giro_det){
        _dataTampil.fa_pembayaran_giro_det[bpc]['jth_tempo']  =  new Date(_dataTampil.fa_pembayaran_giro_det[bpc]['jth_tempo']);
      }
      $scope.dataForm['bpc']        = _dataTampil.fa_pembayaran_giro_det;
    }
    
    
    $scope.dataForm['gl']   = _dataTampil.fa_pembayaran_jurnal_det;
    delete $scope.dataForm['gl']['dept'];
    delete $scope.dataForm['gl']['acc_cost_center'];
    delete $scope.dataForm['gl']['acc_coas_mst'];
    
    //$scope.dataForm['gl_a']         = _dataTampil.fa_pembayaran_jurnal_det;
    //$scope.dataForm['gl_c']       = _dataTampil.fa_pembayaran_jurnal_det;
    /*$scope.dataForm['ar_det']     = _dataTampil.fa_pembayaran_ar_det;
    $scope.dataForm['ap_det']     = _dataTampil.fa_penerimaan_ap_det;*/
    
    //console.log(_dataTampil.fa_pembayaran_jurnal_det);
    /*delete $scope.dataForm['fa_penerimaan_jurnal_det'];
    delete $scope.dataForm['fa_penerimaan_ar_det'];
    delete $scope.dataForm['fa_penerimaan_ap_det'];*/
  }

});

app.directive('formPembayaran', function (){
    return{
        restirct    : 'A',
        templateUrl : '/assets/ng/views/keu/form/formPembayaran.html',
    };
});

app.directive('lovCustomer', function (){
    return{
        restirct    : 'A',
        templateUrl : '/ext/ng-html/PMS/lov/lovCustomer.html',
    };
});


function apiModifyTable(originalData,id,response){
    angular.forEach(originalData, function (item,key) {
      // console.log(item.id_customer +' \\ '+key+' / '+id);
        if(item.no == id){
            originalData[key] = response;
        }
    });
    return originalData;
}