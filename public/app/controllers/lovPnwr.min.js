app.controller('lovPnwrController', function($scope, $http, $uibModalInstance, parameter, API_URL) {
	$scope.libraryTemp = {};
  $scope.totalItemsTemp = {};
  $scope.totalItems = 0;
  $scope.subUrl = 'check/pms/pnwrMst';
  $scope.parameter = {};

    //retrieve employees listing from API
    // console.log(parameter);

    $scope.parameter = parameter;
    getResultsPage(1);

    $scope.searchDB = function(){
        if($scope.searchText.length >= 1){
          // console.log($scope.libraryTemp);
          if($.isEmptyObject($scope.libraryTemp)){
                $scope.libraryTemp = $scope._data;
                $scope.totalItemsTemp = $scope.totalItems;
                $scope._data = {};
          }
          getResultsPage(1);
        }else{
          // console.log('masuk');
            if(!$.isEmptyObject($scope.libraryTemp)){
                $scope._data = $scope.libraryTemp ;
                $scope.totalItems = $scope.totalItemsTemp;
                $scope.libraryTemp = {};
            }
        }
    }

    $scope.pageChanged = function(newPage) {
      getResultsPage(newPage);
    };

    $scope.cancel = function () {
      $uibModalInstance.dismiss('cancel');
    };

    $scope.pilih = function(_parameter){
      // console.log(_parameter);
      $uibModalInstance.close(_parameter);
    }
/*

*/
  function getResultsPage(pageNumber) {
      if(! $.isEmptyObject($scope.libraryTemp)){
        $http({
          'method'  : 'GET',
          'url'     : API_URL+$scope.subUrl+'?search='+$scope.searchText+'&page='+pageNumber+'&lov=true',
          'param'   : $.param($scope.parameter),
          'headers' : {'Content-Type': 'application/x-www-form-urlencoded'}
        }).success(function(response){
          // console.log(response);
          $scope._data     = response.data;
          $scope.totalItems   = response.total;
          $scope.table = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
            console.log(response);
        });
      }else{
        console.log($scope.parameter);
        url = API_URL+$scope.subUrl+'?page='+pageNumber+'&lov=true';
        
        if(!angular.isUndefined($scope.parameter['_f_customer'])){
          url += '&f_customer='+$scope.parameter['_f_customer'];
        }

        if($scope.parameter['_not_in'] instanceof Array){
          url += '&not_in='+($scope.parameter['_not_in']).join();
        }

        $http({
          'method'  : 'GET',
          // 'url'     : API_URL+$scope.subUrl+'?page='+pageNumber+'&lov=true'
          'url'     : url 
        }).success(function(response){
          // console.log(response);
          $scope._data     = response.data;
          $scope.totalItems   = response.total;
          $scope.table = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
          console.log(response);
        });
      }
  }

});
