var app = angular
          .module('appRoot', ['ngMessages','ngRoute', 'ngMask'])
          .config(function($interpolateProvider){
              $interpolateProvider.startSymbol('[[');
              $interpolateProvider.endSymbol(']]');
          })
        .directive('loading', ['$http',function($http){
          return {
            restrict: 'A',
            link : function(scope, element, attrs){
              scope.isLoading = function(){
                return $http.pendingRequests.length > 0;
              };

              scope.$watch(scope.isLoading, function(value){
                if(value){
                  element.show(); 
                } else{
                  element.hide();
                }
              })
            }
          }
        }]);

app.controller('dataFormController', function($scope, $http) {
  $scope._data = {}; 
  $scope.libraryTemp = {};
  $scope.totalItemsTemp = {};
  $scope.totalItems = 0;
  $scope.subUrl = 'realisasi';
  $modalName ='idModalMst';

    //retrieve employees listing from API
    getResultsPage(1);
/*

    //show modal form
    $scope.toggle = function(modalstate, id){
      $scope.modalstate = modalstate; 

      switch(modalstate){
        case 'add' :
          $scope.form_title = 'Tambah Data';
          $scope.dataForm = null;
        break;
        case 'edit' :
          $scope.form_title = 'Edit Data';
          $scope.idState = id;
          $http.get(API_URL + $scope.subUrl+"/" + id)
            .success(function(response){
              // console.log(response);
              $scope.dataForm = response;
            });
        break;
        default:
        break;
      }

      $('#'+$modalName).modal('show');
    }
*/
    $scope.save = function(value, id){
      // var _url = API_URL + $scope.subUrl;
      // var _method = (modalstate === 'edit') ? 'PUT' : 'POST';


      console.log(value);
      // $http({
      //   'method'  : 'POST',
      //   'url'     : $scope.subUrl + '/' +id,
      //   'data'    : $.param($scope.dataForm),
      //   'headers' : {'Content-Type': 'application/x-www-form-urlencoded'}
      // }).success(function(response){
      //   // console.log(response);
      //   if(modalstate === 'edit') {
      //     $scope._data = apiModifyTable($scope._data, response.id_customer, response);
      //   }
      //   else {
      //     // console.log(response);
      //     $scope._data.push(response);
      //   }
          
      //   $('#'+$modalName).modal('hide');
      //   $.gritter.add({
      //         title: 'Application',
      //         text: 'Data Berhasil Disimpan',
      //         fade_out_speed: 5000
      //     });
      // }).error(function(error){
      //   console.log(error);
      // });

    }

/*
    $scope.confirmDelete = function(_data, _index){
      var isConfirmDelete = confirm('Anda yakin mau menghapus data ini?');
      if(isConfirmDelete){
        $http({
          'method'  : 'DELETE',
          'url'     : API_URL+$scope.subUrl+'/'+_data.id_customer 
        }).success(function(response){
          $scope._data.splice(_index,1);
          $.gritter.add({
                title: 'Application',
                text: 'Data Berhasil Dihapus',
                fade_out_speed: 5000
            });
        }).error(function(response){
          console.log(response);
          $.gritter.add({
                title: 'Application',
                text: 'Data Gagal Dihapus',
                fade_out_speed: 5000
            });
        });
      }
    }
  
    $scope.searchDB = function(){
        if($scope.searchText.length >= 1){
          // console.log($scope.libraryTemp);
          if($.isEmptyObject($scope.libraryTemp)){
                $scope.libraryTemp = $scope._data;
                $scope.totalItemsTemp = $scope.totalItems;
                $scope._data = {};
          }
          getResultsPage(1);
        }else{
          // console.log('masuk');
            if(!$.isEmptyObject($scope.libraryTemp)){
                $scope._data = $scope.libraryTemp ;
                $scope.totalItems = $scope.totalItemsTemp;
                $scope.libraryTemp = {};
            }
        }
    }

    $scope.pageChanged = function(newPage) {
      getResultsPage(newPage);
    };


*/
  function getResultsPage(pageNumber) {
      // if(! $.isEmptyObject($scope.libraryTemp)){
      //   $http({
      //     'method'  : 'GET',
      //     'url'     : $scope.subUrl+'/NONID/?search='+$scope.searchText+'&page='+pageNumber 
      //   }).success(function(response){
      //     // console.log(response);
      //     $scope._data      = response.data;
      //     $scope.totalItems = response.total;
      //     $scope.table = { TotalItems : response.total, CurrentItems : response.to };
      //   }).error(function(response){
      //     console.log(response);
      //   });
      // }else{
        $http({
          'method'  : 'GET',
          'url'     : $scope.subUrl+'/NONID/?page='+pageNumber 
        }).success(function(response){
          console.log(response.tanggal.date);
          $scope._tanggal  = new Date(response.tanggal.date);
          $scope._data    = response.data;
          $scope._jam     = Array.apply(0, Array(9)).map(function(val, i) { return i; });

          // console.log($scope._data);
          // $scope.totalItems   = response.total;
          // $scope.table = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
          console.log(response);
        });
      // }
  }

  // function getResultsPage(pageNumber) {
  //     if(! $.isEmptyObject($scope.libraryTemp)){
  //       $http({
  //         'method'  : 'GET',
  //         'url'     : $scope.subUrl+'/NONID/?search='+$scope.searchText+'&page='+pageNumber 
  //       }).success(function(response){
  //         // console.log(response);
  //         $scope._data      = response.data;
  //         $scope.totalItems = response.total;
  //         $scope.table = { TotalItems : response.total, CurrentItems : response.to };
  //       }).error(function(response){
  //         console.log(response);
  //       });
  //     }else{
  //       $http({
  //         'method'  : 'GET',
  //         'url'     : $scope.subUrl+'/NONID/?page='+pageNumber 
  //       }).success(function(response){
  //         console.log(response);
  //         $scope._data     = response;//.data;
  //         // console.log($scope._data);
  //         // $scope.totalItems   = response.total;
  //         // $scope.table = { TotalItems : response.total, CurrentItems : response.to };
  //       }).error(function(response){
  //         console.log(response);
  //       });
  //     }
  // }

});

// app.directive('modalCustomer', function (){
//     return{
//         restirct    : 'A',
//         templateUrl : '/ext/ng-html/modalCustomer.html',
//     };
// });

function apiModifyTable(originalData,id,response){
    angular.forEach(originalData, function (item,key) {
        if(item.id_customer == id){
            originalData[key] = response;
        }
    });
    return originalData;
}