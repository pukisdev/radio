app.controller('lovSpksController', function($scope, $http, $uibModalInstance, parameter){//, API_URL) {
	$scope.libraryTempSpks = {};
  $scope.totalItemsTempSpks = {};
  $scope.totalItemsSpks = 0;
  $scope.subUrlSpks = '/hkm/spks';
  $scope._token = {};
  $scope._dataSpks = {};

  $scope.parameter = parameter;
  $scope.dataModal = {}

  // console.log($scope.parameter);
  // $scope.dataModal['f_customer'] = $scope.parameter['_f_customer'];

    //retrieve employees listing from API
  $http({
    'method'  : 'GET',
    'url'   : '/token' 
  }).success(function(response){
    // console.log(response);
    $scope._token     = response;

    getResultsPageSpks(1);

  }).error(function(response){
      console.log(response);
  });

  $scope.searchDBSpks = function(){
      if($scope.searchTextSpks.length >= 1){
        // console.log($scope.libraryTempSpks);
        if($.isEmptyObject($scope.libraryTempSpks)){
              $scope.libraryTempSpks = $scope._dataSpks;
              $scope.totalItemsTempSpks = $scope.totalItemsSpks;
              $scope._dataSpks = {};
        }
        getResultsPageSpks(1);
      }else{
        // console.log('masuk');
          if(!$.isEmptyObject($scope.libraryTempSpks)){
              $scope._dataSpks = $scope.libraryTempSpks ;
              $scope.totalItemsSpks = $scope.totalItemsTempSpks;
              $scope.libraryTempSpks = {};
          }
      }
  }

  $scope.pageChangedSpks = function(newPage) {
    getResultsPageSpks(newPage);
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.lovSpksSelected = function(_element){
    // console.log(_element);
    $uibModalInstance.close(_element);
  }

  $scope.getFileSpks = function(_name){
    var _url = $scope._token['url']+ '/hkm/spks';
    if($.isEmptyObject($scope._token)) return false;
    window.open(_url+'/files/spks'+'/'+_name, '_blank'); 
  }

/*

*/
  function getResultsPageSpks(pageNumber) {
      var _url = $scope._token['url']+ $scope.subUrlSpks;

      // var $body = angular.element(document.body);   // 1
      // var $rootScope = $body.injector().get('$rootScope');;  
      // console.log($scope.dataForm);

      if(! $.isEmptyObject($scope.libraryTempSpks)){
        $http({
          'method'  : 'GET',
          // 'url'     : API_URL+$scope.subUrlSpks+'?search='+$scope.searchTextSpks+'&page='+pageNumber 
          'url'     : _url+'?search='+$scope.searchTextSpks+'&page='+pageNumber 
        }).success(function(response){
          // console.log(response);
          $scope._dataSpks      = response.data;
          $scope.totalItemsSpks = response.total;
          $scope.tableSpks      = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
            console.log(response);
        });
      }else{
        $http({
          'method'  : 'GET',
          // 'url'   : API_URL+$scope.subUrlSpks+'?page='+pageNumber 
          'url'   : _url+'?page='+pageNumber+'&f_customer='+$scope.parameter['_f_customer'] 
        }).success(function(response){
          // console.log($scope._dataSpks);
          $scope._dataSpks        = response.data;
          $scope.totalItemsSpks   = response.total;
          $scope.tableSpks        = { TotalItems : response.total, CurrentItems : response.to };
        }).error(function(response){
          console.log(response);
        });
      }
  }

}); 
